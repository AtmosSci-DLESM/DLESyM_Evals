# =============================================================================
# Atmosphere Evaluation Configuration
# =============================================================================
# This config is specifically for atmosphere forecast evaluation.
# For ocean evaluation, use ocean_config.yaml.

evaluation:
  # ----------------------------------------------------------------------------
  # Time Configuration
  # ----------------------------------------------------------------------------
  time_start: "2019-01-02"
  # time_stop: "2019-12-31"
  time_stop: "2019-03-01"

  # time_start: "2021-01-02"
  # time_stop: "2021-05-29"
  
  init_chunk_size: 4

  # ----------------------------------------------------------------------------
  # Data Loaders
  # ----------------------------------------------------------------------------
  data:
    prediction:
      # Must match the class name defined in your python script
      class: "DLESyMPredictionsFromXarray"
      path: "/pscratch/sd/z/zespinos/crps_deterministic_inference/crps_ocean_ze_003.002.000/forecast_atmos_ll.zarr"
      # Atmosphere variables
      # variables: ["t2m", "t850", "tau300-700", "tcwv", "ws10", "z250", "z500", "z1000", "ttr"]
      variables: ["z500"]
      # variables: ["t2m", "t850", "ws10", "z250", "z500", "z1000", "ttr"]
      
      # Optional: Rename variables to match WBX standards or Target data
      # rename:
      #   temp_850: "t850"
      #   geopotential_500: "z500"
      
      # Loader specific args (passed to super().__init__)
      compute: true        # Load data into memory after opening
      add_nan_mask: true  # Set true if you need to handle sparse masks

    target:
      class: "DLESyMTargetsFromXarray"
      path: "/pscratch/sd/z/zespinos/datasets/ll_1deg_1950-2023_3h_9var_atm_coupled-sst_sic.zarr"
      # Atmosphere variables
      # variables: ["t2m", "t850", "tau300-700", "tcwv", "ws10", "z250", "z500", "z1000", "ttr"]
      variables: ["z500"]
      # variables: ["t2m", "t850", "ws10", "z250", "z500", "z1000", "ttr"]

  # ----------------------------------------------------------------------------
  # Metrics
  # ----------------------------------------------------------------------------
  # Groups of metrics to compute.
  # Options supported by your script: "deterministic" (RMSE, Bias, ACC), "probabilistic" (CRPS, Spread)
  metrics: 
    # - "deterministic"
    - "probabilistic" # Uncomment if your prediction data has an 'ensemble' dimension

  # ----------------------------------------------------------------------------
  # Aggregation (Spatial Reduction)
  # ----------------------------------------------------------------------------
  masking:
    enabled: false  # No masking for atmosphere (evaluate over all grid points)
    type: "land"    # Not used when enabled: false
    path: "/pscratch/sd/z/zespinos/Data/ERA5/daily/era5_1950-2023_daily_1deg_lsm.nc"
    variable: "lsm"
    threshold: 0.5

  aggregation:
    # Dimensions to collapse during aggregation (usually Lat/Lon to get a global scalar)
    reduce_dims: ["latitude", "longitude"]
    
    weighting:
      class: "GridAreaWeighting"
      latitude_name: "latitude" # Check your files: usually 'lat' or 'latitude'

  # ----------------------------------------------------------------------------
  # Spatial Regions (used for binning in Aggregator)
  # ----------------------------------------------------------------------------
  # NOTE: Longitudes here assume a 0â€“360 convention. 
  regions:
    global:
      lat_min: -90
      lat_max: 90
      lon_min: 0
      lon_max: 360
    tropics:
      lat_min: -20
      lat_max: 20
      lon_min: 0
      lon_max: 360
    arctic:
      lat_min: 60
      lat_max: 90
      lon_min: 0
      lon_max: 360
    antarctic:
      lat_min: -90
      lat_max: -60
      lon_min: 0
      lon_max: 360

  # ----------------------------------------------------------------------------
  # Output
  # ----------------------------------------------------------------------------
  output:
    path: "/pscratch/sd/z/zespinos/crps_deterministic_evals/evals_atmos_timeseries.nc"
    
    # Required if 'deterministic' metrics (ACC) are requested.
    # Defines the climatology mean for Anomaly Correlation Coefficient.
    climatology_path: "/pscratch/sd/z/zespinos/datasets/climatologies/ll_1deg_1950-2023_3h_9var_atm_coupled-sst_sic_clim.zarr"

  # ----------------------------------------------------------------------------
  # Baseline Evaluation (Climatology/Persistence)
  # ----------------------------------------------------------------------------
  # Generate evaluation files for baseline forecasts (climatology or persistence)
  baseline_eval:
    enabled: false  # Set to true to generate baseline evaluation
    type: "climatology"  # Options: "probabilistic_climatology", "climatology" or "persistence"
    # For persistence, climatology_path is not used (uses target dataset instead)
    climatology_path: "/pscratch/sd/z/zespinos/datasets/climatologies/ll_1deg_1950-2023_3h_9var_atm_coupled-sst_sic_clim.zarr"
    # Note: <forecast_type> and <type> will be replaced automatically
    output_path: "/pscratch/sd/z/zespinos/crps_deterministic_evals/evals_atmos_<type>_timeseries.nc"
    # Lead times configuration for baseline evaluations
    # If not specified, will use lead_time from target dataset or default to 0-96h in 6h steps
    start_year: 2020
    end_year: 2023
    lead_times:
      start: 0        # Start time (hours or days)
      stop: 2208      # Stop time (hours) - 92 days * 24 hours = 2208
      step: 24        # Step size (hours) - every 24 hours
      unit: "hours"   # Unit: "hours" or "days"
